<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Test Game (20 Songs)</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        #game-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        p {
            color: #555;
            line-height: 1.6;
        }

        #controls button,
        #guess-section button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s ease;
        }

        #controls button:hover,
        #guess-section button:hover {
            background-color: #0056b3;
        }

        #controls button:disabled,
        #guess-section button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #guess-input {
            padding: 10px;
            font-size: 16px;
            margin: 10px 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 22px); /* Adjust for padding and border */
            max-width: 300px;
        }

        #feedback {
            margin-top: 15px;
            font-weight: bold;
        }

        #feedback.correct {
            color: #28a745; /* Green */
        }

        #feedback.incorrect {
            color: #dc3545; /* Red */
        }

         #answer {
            margin-top: 10px;
            color: #17a2b8; /* Info blue */
            font-style: italic;
        }

        #score {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        /* Hide elements initially */
        #guess-section, #next-btn, #feedback, #answer {
            display: none;
        }
         #audio-player {
             display: none; /* Hide the default audio player controls */
         }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Blind Test Game (20 Songs)</h1>
        <p id="instructions">Press "Start Game" to hear the first song snippet!</p>

        <audio id="audio-player" controls></audio>

        <div id="controls">
            <button id="start-btn">Start Game</button>
            <button id="play-btn" disabled>Play Snippet</button>
            <button id="next-btn">Next Song</button>
        </div>

        <div id="guess-section">
            <input type="text" id="guess-input" placeholder="Enter song title guess">
            <button id="submit-btn">Submit Guess</button>
        </div>

        <div id="feedback"></div>
        <div id="answer"></div>
        <div id="score">Score: 0 / 0</div>
    </div>

    <script>
        // --- Configuration ---
        const snippetDuration = 10; // Play snippet for 10 seconds
        // 20 Copyright-Free songs from Pixabay
        const songs = [
            { title: "Lofi Study", artist: "FASSounds", url: "https://cdn.pixabay.com/audio/2022/05/27/audio_1819c1671f.mp3" },
            { title: "The Beat of Nature", artist: "Olexy", url: "https://cdn.pixabay.com/audio/2022/01/18/audio_ea80767449.mp3" },
            { title: "Smoke", artist: "SoulProdMusic", url: "https://cdn.pixabay.com/audio/2023/08/01/audio_a3007a175f.mp3" },
            { title: "Ambient Classical Guitar", artist: "William_King", url: "https://cdn.pixabay.com/audio/2023/05/29/audio_7e4b166b89.mp3" },
            { title: "Tropical Summer", artist: "Luke Bergs", url: "https://cdn.pixabay.com/audio/2021/08/09/audio_a81e2f9802.mp3" },
            { title: "In the Moment", artist: "Alexi Action", url: "https://cdn.pixabay.com/audio/2022/12/21/audio_340d2b1a49.mp3" },
            { title: "Emotional Cinematic Piano", artist: "Oleksii Holzu", url: "https://cdn.pixabay.com/audio/2024/03/13/audio_1ec019d9a3.mp3" },
            { title: "Future Bass", artist: "Music_For_Videos", url: "https://cdn.pixabay.com/audio/2023/08/03/audio_5db097e36b.mp3" },
            { title: "Just Relax", artist: "Lesfm", url: "https://cdn.pixabay.com/audio/2021/11/23/audio_8c1398b720.mp3" },
            { title: "Good Night", artist: "FASSounds", url: "https://cdn.pixabay.com/audio/2022/04/07/audio_7961d3705c.mp3" },
            { title: "Inspiring Cinematic Ambient", artist: "Lexin_Music", url: "https://cdn.pixabay.com/audio/2022/08/04/audio_2dead139f7.mp3" },
            { title: "Epic Cinematic", artist: "AudioCoffee", url: "https://cdn.pixabay.com/audio/2024/01/14/audio_3b347c941a.mp3" },
            { title: "Ukulele Fun", artist: "Playsound", url: "https://cdn.pixabay.com/audio/2022/06/14/audio_4f3b015f6a.mp3" },
            { title: "Medieval Tale", artist: "Vadim Krakhmal", url: "https://cdn.pixabay.com/audio/2023/09/22/audio_7d8896b617.mp3" },
            { title: "Spirit Blossom", artist: "RomanSenykMusic", url: "https://cdn.pixabay.com/audio/2022/02/07/audio_67c71a8418.mp3" },
            { title: "Morning Garden Acoustic", artist: "Olexy", url: "https://cdn.pixabay.com/audio/2022/10/11/audio_5708164799.mp3" },
            { title: "Powerful Beat", artist: "RedLionProduction", url: "https://cdn.pixabay.com/audio/2024/03/30/audio_c0d2a49747.mp3" },
            { title: "The Introvert", artist: "Michael Kobrin", url: "https://cdn.pixabay.com/audio/2021/11/17/audio_7945c36c37.mp3" },
            { title: "8 Bit Retro", artist: "ComaStudio", url: "https://cdn.pixabay.com/audio/2022/01/27/audio_a31f865623.mp3" },
            { title: "Empty Mind", artist: "Lofi_hour", url: "https://cdn.pixabay.com/audio/2023/11/05/audio_40614c1b40.mp3" }
            // Note: Always double-check Pixabay's license terms if using for commercial purposes.
            // For a personal GitHub Pages project like this, their standard license is typically sufficient.
        ];

        // --- Game State Variables ---
        let currentSongIndex = -1;
        let score = 0;
        let songsPlayed = 0;
        let playedIndices = new Set(); // Keep track of songs played in this round
        let currentAudio = null; // To keep track of the currently playing audio snippet timeout

        // --- DOM Elements ---
        const startBtn = document.getElementById('start-btn');
        const playBtn = document.getElementById('play-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const guessInput = document.getElementById('guess-input');
        const feedbackDiv = document.getElementById('feedback');
        const answerDiv = document.getElementById('answer');
        const scoreDiv = document.getElementById('score');
        const instructionsP = document.getElementById('instructions');
        const guessSectionDiv = document.getElementById('guess-section');
        const audioPlayer = document.getElementById('audio-player');

        // --- Functions ---

        function getRandomSongIndex() {
            if (playedIndices.size >= songs.length) {
                return -1; // No more unique songs left
            }
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * songs.length);
            } while (playedIndices.has(randomIndex));
            playedIndices.add(randomIndex);
            return randomIndex;
        }

        function loadSong() {
            currentSongIndex = getRandomSongIndex();

            if (currentSongIndex === -1) {
                endGame("You've heard all the songs!");
                return false;
            }

            const song = songs[currentSongIndex];
            audioPlayer.src = song.url;
            audioPlayer.load(); // Prepares the audio player

            // Reset UI for the new song
            guessInput.value = '';
            feedbackDiv.textContent = '';
            feedbackDiv.className = ''; // Remove correct/incorrect classes
            answerDiv.style.display = 'none'; // Hide previous answer
            guessInput.disabled = false;
            submitBtn.disabled = false;
            playBtn.disabled = false; // Enable play button *after* loading
            nextBtn.style.display = 'none'; // Hide Next Song button until guess is made
            guessSectionDiv.style.display = 'block'; // Show guessing UI
            instructionsP.textContent = `Song ${playedIndices.size} of ${songs.length}. Press "Play Snippet".`; // Use playedIndices.size for 1-based counting

            return true; // Song loaded successfully
        }

        function playSnippet() {
            if (!audioPlayer.src || currentSongIndex === -1) return;

            audioPlayer.currentTime = 0;
            audioPlayer.play()
                .then(() => {
                    playBtn.disabled = true;
                    if (currentAudio) clearTimeout(currentAudio);
                    currentAudio = setTimeout(() => {
                        audioPlayer.pause();
                        playBtn.disabled = false;
                        currentAudio = null;
                    }, snippetDuration * 1000);
                })
                .catch(error => {
                    console.error("Error playing audio:", error);
                    feedbackDiv.textContent = "Error playing audio. Try again or check console.";
                    feedbackDiv.className = 'incorrect';
                    playBtn.disabled = false;
                });
        }


        function checkGuess() {
            if (currentSongIndex === -1) return;

            const userGuess = guessInput.value.trim().toLowerCase();
            const correctTitle = songs[currentSongIndex].title.trim().toLowerCase();

            if (currentAudio) {
                clearTimeout(currentAudio);
                audioPlayer.pause();
                currentAudio = null;
            }

            // Increment songsPlayed here, after a guess is submitted for the current song
            // Note: We use playedIndices.size in loadSong for "Song X of Y" display
            // but track actual *attempts* with songsPlayed for score display.
            // Let's keep it simple: use playedIndices.size for the total in score too.
            // songsPlayed = playedIndices.size; // Use the count of unique songs presented

            if (userGuess === correctTitle) {
                score++;
                feedbackDiv.textContent = "Correct!";
                feedbackDiv.className = 'correct';
            } else {
                feedbackDiv.textContent = "Incorrect!";
                feedbackDiv.className = 'incorrect';
            }

            answerDiv.textContent = `The song was: ${songs[currentSongIndex].title} by ${songs[currentSongIndex].artist}`;
            answerDiv.style.display = 'block';
            feedbackDiv.style.display = 'block';

            // Update score display using the count of songs presented so far
             scoreDiv.textContent = `Score: ${score} / ${playedIndices.size}`;

            guessInput.disabled = true;
            submitBtn.disabled = true;
            playBtn.disabled = true;

            nextBtn.style.display = 'inline-block';
            if (playedIndices.size >= songs.length) {
                 nextBtn.textContent = "Show Final Score";
            } else {
                 nextBtn.textContent = "Next Song";
            }
        }

         function nextRound() {
             // songsPlayed state is managed implicitly by playedIndices.size now
             if (playedIndices.size >= songs.length) {
                endGame("Game Over!");
             } else {
                if (!loadSong()) {
                    // This case should technically not be reachable if the size check is correct
                     endGame("Couldn't load the next song.");
                 }
             }
         }

        function startGame() {
             score = 0;
             // songsPlayed = 0; // No longer needed explicitly
             playedIndices.clear(); // Reset played songs for a new game
             scoreDiv.textContent = `Score: 0 / 0`;
             feedbackDiv.style.display = 'none';
             answerDiv.style.display = 'none';
             startBtn.style.display = 'none'; // Hide Start button
             nextBtn.textContent = 'Next Song'; // Ensure it says 'Next Song'

             if (!loadSong()) { // Load the first song
                 endGame("No songs available to start the game.");
             } else {
                 instructionsP.textContent = `Game started! Song ${playedIndices.size} of ${songs.length}. Press "Play Snippet".`;
             }
        }

        function endGame(message) {
             // Final score uses the total number of unique songs presented (playedIndices.size)
             instructionsP.textContent = `${message} Final Score: ${score} / ${playedIndices.size}`;
             playBtn.disabled = true;
             submitBtn.disabled = true;
             guessInput.disabled = true;
             guessSectionDiv.style.display = 'none'; // Hide guessing area
             nextBtn.style.display = 'none'; // Hide 'Next/End' button
             startBtn.style.display = 'inline-block'; // Show start button again
             startBtn.textContent = 'Play Again?'; // Change text for replay
             if (currentAudio) {
                 clearTimeout(currentAudio);
                 audioPlayer.pause();
                 currentAudio = null;
             }
             audioPlayer.src = ''; // Clear audio source
        }


        // --- Event Listeners ---
        startBtn.addEventListener('click', startGame);
        playBtn.addEventListener('click', playSnippet);
        submitBtn.addEventListener('click', checkGuess);
        nextBtn.addEventListener('click', nextRound);

         guessInput.addEventListener('keypress', function(event) {
             if (event.key === 'Enter' && !submitBtn.disabled) {
                 event.preventDefault();
                 checkGuess();
             }
         });

    </script>
</body>
</html>